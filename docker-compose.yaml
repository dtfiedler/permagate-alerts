services:
  api:
    image: ghcr.io/dtfiedler/permagate-alerts:latest
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - '${PORT:-3000}:${PORT:-3000}'
    environment:
      - PORT=${PORT:-3000}
      - NODE_ENV=${NODE_ENV:-development}
      - HOST_URL=${HOST_URL:-http://localhost:3000}
      - SKIP_TO_CURRENT_BLOCK=${SKIP_TO_CURRENT_BLOCK:-true}
      - GQL_URL=${GQL_URL:-https://arweave-search.goldsky.com/graphql}
      - LOG_LEVEL=${LOG_LEVEL:-}
      - ADMIN_API_KEY=${ADMIN_API_KEY:-}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
      - AWS_REGION=${AWS_REGION:-us-east-1}
      - AWS_FROM_EMAIL=${AWS_FROM_EMAIL:-}
      # API only handles requests - all notifications handled by worker
      - DISABLE_EMAIL_NOTIFICATIONS=true
      - DISABLE_WEBHOOK_NOTIFICATIONS=true
      - DISABLE_EVENT_PROCESSING=true
      - DISABLE_GATEWAY_MONITORING=true
      - DISABLE_ARNS_SYNC=true
      - ENABLE_HOSTED_FRONTEND=false
      - FRONTEND_URL=${FRONTEND_URL:-https://subscribe.permagate.io}
      - SECRET_KEY=${SECRET_KEY:-}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY:-}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET:-}
    volumes:
      - ./data:/usr/src/app/data

  worker:
    image: ghcr.io/dtfiedler/permagate-alerts:latest
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - PORT=${PORT:-3000}
      - NODE_ENV=${NODE_ENV:-development}
      - HOST_URL=${HOST_URL:-http://localhost:3000}
      - SKIP_TO_CURRENT_BLOCK=${SKIP_TO_CURRENT_BLOCK:-true}
      - GQL_URL=${GQL_URL:-https://arweave-search.goldsky.com/graphql}
      - LOG_LEVEL=${LOG_LEVEL:-}
      - ADMIN_API_KEY=${ADMIN_API_KEY:-}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
      - AWS_REGION=${AWS_REGION:-us-east-1}
      - AWS_FROM_EMAIL=${AWS_FROM_EMAIL:-}
      # Worker handles all notifications and background processing
      - DISABLE_EMAIL_NOTIFICATIONS=${DISABLE_EMAIL_NOTIFICATIONS:-false}
      - DISABLE_WEBHOOK_NOTIFICATIONS=${DISABLE_WEBHOOK_NOTIFICATIONS:-false}
      - DISABLE_EVENT_PROCESSING=${DISABLE_EVENT_PROCESSING:-false}
      - DISABLE_GATEWAY_MONITORING=${DISABLE_GATEWAY_MONITORING:-false}
      - DISABLE_ARNS_SYNC=${DISABLE_ARNS_SYNC:-false}
      - FRONTEND_URL=${FRONTEND_URL:-https://subscribe.permagate.io}
      - SECRET_KEY=${SECRET_KEY:-}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY:-}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET:-}
      - ENABLE_HOSTED_FRONTEND=false
    volumes:
      - ./data:/usr/src/app/data
